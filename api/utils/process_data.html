<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>utils.process_data module &mdash; T-Res 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="utils.process_wikipedia module" href="process_wikipedia.html" />
    <link rel="prev" title="utils.preprocess_data module" href="preprocess_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> T-Res
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../t-res-api/index.html">Running T-Res as API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../geoparser/index.html"><code class="docutils literal notranslate"><span class="pre">geoparser</span></code> module</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html"><code class="docutils literal notranslate"><span class="pre">utils</span></code> module</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="deezy_processing.html"><code class="docutils literal notranslate"><span class="pre">utils.deezy_processing</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="get_data.html"><code class="docutils literal notranslate"><span class="pre">utils.get_data</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ner.html"><code class="docutils literal notranslate"><span class="pre">utils.ner</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="preprocess_data.html"><code class="docutils literal notranslate"><span class="pre">utils.preprocess_data</span></code> module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">utils.process_data</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="process_wikipedia.html"><code class="docutils literal notranslate"><span class="pre">utils.process_wikipedia</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="rel_e2e.html"><code class="docutils literal notranslate"><span class="pre">utils.rel_e2e</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="rel_utils.html"><code class="docutils literal notranslate"><span class="pre">utils.rel_utils</span></code> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="rel/index.html"><code class="docutils literal notranslate"><span class="pre">utils.REL</span></code> module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other-files/index.html">Other files in repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">T-Res</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">API Documentation</a> &raquo;</li>
          <li><a href="index.html"><code class="docutils literal notranslate"><span class="pre">utils</span></code> module</a> &raquo;</li>
      <li><code class="docutils literal notranslate"><span class="pre">utils.process_data</span></code> module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api/utils/process_data.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="utils-process-data-module">
<h1><code class="docutils literal notranslate"><span class="pre">utils.process_data</span></code> module<a class="headerlink" href="#utils-process-data-module" title="Permalink to this headline"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.eval_with_exception">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">eval_with_exception</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">str2parse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_case</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.eval_with_exception" title="Permalink to this definition"></a></dt>
<dd><p>Given a string in the form or a list or dictionary, parse it
to read it as such.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str2parse</strong> (<em>str</em>) – the string to parse.</p></li>
<li><p><strong>in_case</strong> (<em>str</em>) – what should be returned in case of error.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.prepare_sents">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">prepare_sents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.prepare_sents" title="Permalink to this definition"></a></dt>
<dd><p>Prepares annotated data and metadata on a sentence basis.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><dl class="simple">
<dt>dictionary in which we keep, for each article/sentence</dt><dd><p>(expressed as e.g. “10732214_1”, where “10732214” is the article_id
and “1” is the order of the sentence in the article), the full original
unprocessed sentence.</p>
</dd>
<dt>dAnnotated (dict): dictionary in which we keep, for each article/sentence,</dt><dd><p>an inner dictionary mapping the position of an annotated named entity (i.e.
its start and end character, as a tuple, as the key) and another tuple as
its value, which consists of: the type of named entity (such as LOC
or BUILDING, the mention, and its annotated link), all extracted from
the gold standard.</p>
</dd>
<dt>dMetadata (dict): dictionary in which we keep, for each article/sentence,</dt><dd><p>its metadata: place (of publication), year, ocr_quality_mean, ocr_quality_sd,
publication_title, publication_code, and place_wqid (Wikidata ID of the
place of publication).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dSentences (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.align_gold">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">align_gold</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotations</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.align_gold" title="Permalink to this definition"></a></dt>
<dd><p>The gold standard tokenisation is not aligned with the tokenization
produced through the BERT model (as it uses its own tokenizer). To
be able to assess the performance of the entity recogniser, we must
align the two tokenisations. This function aligns the output of BERT
NER and the gold standard labels. It does so based on the start and
end position of each predicted token. By default, a predicted token
is assigned the “O” label, unless its position overlaps with the
position an annotated entity, in which case we relabel it according
to the label found in this position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictions</strong> (<em>list</em>) – list of dictionaries, each corresponding to
a mention.</p></li>
<li><p><strong>annotations</strong> (<em>dict</em>) – a dictionary, in which the key is a tuple
containing the first and last character position of a gold
standard detection in a sentence and the value is a tuple
with the type of label (e.g. “LOC”), the mention (e.g.
“Point Petre”, and the link (e.g. “Q335322”)).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>gold_standard ()</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.postprocess_predictions">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">postprocess_predictions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gold_positions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.postprocess_predictions" title="Permalink to this definition"></a></dt>
<dd><p>Postprocess predictions to be used later in the pipeline.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictions</strong> (<em>list</em>) – the output of the recogniser.ner_predict()
method, where, given a sentence, a list of dictionaries is
returned, where each dictionary corresponds to a recognised
token, e.g.: {‘entity’: ‘O’, ‘score’: 0.99975187, ‘word’:
‘From’, ‘start’: 0, ‘end’: 4}</p></li>
<li><p><strong>gold_positions</strong> (<em>list</em>) – the output of the align_gold() function,
which aligns the gold standard text to the tokenisation
performed by the named entity recogniser, to enable
assessing the performance of the NER and linking steps.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dictionary with three key-value</dt><dd><p>pairs: (1) sentence_preds is mapped to the list of lists
representation of ‘predictions’, (2) sentence_trues is
mapped to the list of lists representation of ‘gold_positions’,
and (3) sentence_skys is the same as sentence_trues, but
with empty link.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>postprocessed_sentence (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.ner_and_process">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">ner_and_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dSentences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dAnnotated</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myner</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.ner_and_process" title="Permalink to this definition"></a></dt>
<dd><p>Perform named entity recognition in the LwM way, and postprocess the
output to prepare it for the experiments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dSentences</strong> (<em>dict</em>) – dictionary in which we keep, for each article/sentence
(expressed as e.g. “10732214_1”, where “10732214” is the article_id
and “1” is the order of the sentence in the article), the full original
unprocessed sentence.</p></li>
<li><p><strong>dAnnotated</strong> (<em>dict</em>) – dictionary in which we keep, for each article/sentence,
an inner dictionary mapping the position of an annotated named entity (i.e.
its start and end character, as a tuple, as the key) and another tuple as
its value, which consists of: the type of named entity (such as LOC
or BUILDING, the mention, and its annotated link), all extracted from
the gold standard.</p></li>
<li><p><strong>myner</strong> (<em>recogniser.Recogniser</em>) – a Recogniser object, for NER.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl>
<dt>dictionary where the NER predictions are stored, where the key</dt><dd><p>is the sentence_id (i.e. article_id + “_” + sentence_pos) and the value is
a list of lists, where each element corresponds to one token in a sentence,
for example:</p>
<blockquote>
<div><p>[“From”, “O”, “O”, 0, 4, 0.999826967716217]</p>
</div></blockquote>
<p>…where the the elements are: (1) the token, (2) the NER tag, (3), the link
to wikidata, set to “O” for now because we haven’t performed linking yet, (4)
the starting character of the token, (5) the end character of the token, and
(6) the NER prediction score. This dictionary is stored in the ‘outputs/data’
folder, with prefix “_ner_predictions.json”.</p>
</dd>
<dt>dTrues (dict): a dictionary where the gold standard named entities are stored,</dt><dd><p>which has the same format as dPreds, but with the manually annotated data
instead of the predictions. This dictionary is stored in the ‘outputs/data’
folder, with prefix “_gold_standard.json”.</p>
</dd>
<dt>dSkys (dict): a dictionary where the skyline will be stored, for the linking</dt><dd><p>experiments. At this point, it will be the same as dPreds, without the
NER prediction score. During linking, it will be filled with the gold standard
entities when these have been retrieved using candidates. This dictionary
is stored in the ‘outputs/data’ folder, with prefix “_ner_skyline.json”.</p>
</dd>
<dt>gold_tokenization (dict): a dictionary where the gold standard entities are</dt><dd><p>stored, wehre the key is the sentence_id (i.e. article_id + “_” + sentence_pos)
and the value is a list of dictionaries, each looking like this:</p>
<blockquote>
<div><p>{“entity”: “B-LOC”, “score”: 1.0, “word”: “Unitec”, “start”: 193,
“end”: 199, “link”: “B-Q30”}</p>
</div></blockquote>
<p>…this dictionary is stored in the ‘outputs/data’ folder, with prefix
“_gold_positions.json”.</p>
</dd>
<dt>dMentionsPred (dict): dictionary of detected mentions but not yet linked mentions,</dt><dd><dl>
<dt>for example:</dt><dd><dl>
<dt>”sn83030483-1790-03-03-a-i0001_9”: [</dt><dd><dl class="simple">
<dt>{</dt><dd><p>“mention”: “Unitec ? States”,
“start_offset”: 38,
“end_offset”: 40,
“start_char”: 193,
“end_char”: 206,
“ner_score”: 0.79,
“ner_label”: “LOC”,
“entity_link”: “O”</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>],</p>
</dd>
</dl>
<p>…this dictionary is stored in the ‘outputs/data’ folder, with prefix” _pred_mentions.json”</p>
</dd>
<dt>dMentionsGold (dict): dictionary of gold standard mentions, analogous to the dictionary</dt><dd><p>of detected mentions, but with the gold standard ner_label and entity_link.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dPreds (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.update_with_linking">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">update_with_linking</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ner_predictions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">link_predictions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.update_with_linking" title="Permalink to this definition"></a></dt>
<dd><p>Updates the NER predictions with linking results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ner_predictions</strong> (<em>dict</em>) – dictionary with NER predictions (token-per-token)
for a given sentence.</p></li>
<li><p><strong>link_predictions</strong> (<em>pd.Series</em>) – a pandas series, corresponding to one
row of the test_df, corresponding to one mention.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dictionary like ner_predictions, only with</dt><dd><p>the added link to wikidata.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>resulting_preds (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.update_with_skyline">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">update_with_skyline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ner_predictions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">link_predictions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.update_with_skyline" title="Permalink to this definition"></a></dt>
<dd><p>Update NER predictions with linking results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ner_predictions</strong> (<em>dict</em>) – dictionary with NER predictions (token-per-token)
for a given sentence.</p></li>
<li><p><strong>link_predictions</strong> (<em>pd.Series</em>) – a pandas series, corresponding to one
row of the test_df, corresponding to one mention.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dictionary like ner_predictions, only with</dt><dd><p>the added skyline link to wikidata (i.e. the gold standard candidate
if the candidate has been retrieved via candidate ranking).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>resulting_preds (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.prepare_storing_links">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">prepare_storing_links</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">processed_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.prepare_storing_links" title="Permalink to this definition"></a></dt>
<dd><p>Updates the processed data dictionaries (preds and skys) with the
predicted links for “preds” and with the skyline for “skys” (where
the skyline is “if the gold standard entity is among the candidates,
choose that one”, providing the skyline of the maximum we can possibly
achieve with linking).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>processed_data</strong> (<em>dict</em>) – dictionary of all processed data.</p></li>
<li><p><strong>all_test</strong> (<em>list</em>) – ids of articles in current data split used for testing.</p></li>
<li><p><strong>test_df</strong> (<em>pd.DataFrame</em>) – dataframe with one-mention-per-row that will
be used for testing in this current experiment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.load_processed_data">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">load_processed_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.load_processed_data" title="Permalink to this definition"></a></dt>
<dd><p>Loads the data already processed in a previous run of the code, using
the same parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>experiment</strong> (<em>preparation.Experiment</em>) – an Experiment object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dictionary where the already</dt><dd><p>processed data is stored.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>output_processed_data (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.store_processed_data">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">store_processed_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trues</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gold_tok</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dSentences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dMetadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dMentionsPred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dMentionsGold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dCandidates</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.store_processed_data" title="Permalink to this definition"></a></dt>
<dd><p>This function stores all the postprocessed data as jsons.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment</strong> (<em>preparation.Experiment</em>) – the experiment object.</p></li>
<li><p><strong>preds</strong> (<em>dict</em>) – dictionary of tokens with predictions, per sentence.</p></li>
<li><p><strong>trues</strong> (<em>dict</em>) – dictionary of tokens with gold standard annotations, per sentence.</p></li>
<li><p><strong>skys</strong> (<em>dict</em>) – dictionary of tokens which will keep the skyline, per sentence.</p></li>
<li><p><strong>gold_tok</strong> (<em>dict</em>) – dictionary of tokens with gold standard annotations
as dictionaries, per sentence.</p></li>
<li><p><strong>dSentences</strong> (<em>dict</em>) – dictionary that maps a sentence id with the text.</p></li>
<li><p><strong>dMetadata</strong> (<em>dict</em>) – dictionary that maps a sentence id with the associated metadata.</p></li>
<li><p><strong>dMentionsPred</strong> (<em>dict</em>) – dictionary of predicted mentions, per sentence.</p></li>
<li><p><strong>dMentionsGold</strong> (<em>dict</em>) – dictionary of gold standard mentions, per sentence.</p></li>
<li><p><strong>dCandidates</strong> (<em>dict</em>) – dictionary of candidates, per mention in sentence.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>dictionary of dictionaries, keeping</dt><dd><p>all processed data (predictions, REL, gold standard, candidates)
in one place.</p>
</dd>
</dl>
<p>Also returns one .json file per dictionary, stored in ‘outputs/data’.</p>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict_processed_data (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.create_mentions_df">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">create_mentions_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.create_mentions_df" title="Permalink to this definition"></a></dt>
<dd><p>Create a dataframe for the linking experiment, with one
mention per row.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>experiment</strong> (<em>preparation.Experiment</em>) – the current experiment.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dataframe with one mention</dt><dd><p>per row, and containing all relevant information for subsequent
steps (i.e. for linking).</p>
</dd>
</dl>
<p>It also returns a .tsv file in the “outputs/data/[dataset]/” folder.</p>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>processed_df (pd.DataFrame)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.store_for_scorer">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">store_for_scorer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hipe_scorer_results_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scenario_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dresults</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">articles_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.store_for_scorer" title="Permalink to this definition"></a></dt>
<dd><p>Store results in the right format to be used by the CLEF-HIPE
scorer: <a class="reference external" href="https://github.com/impresso/CLEF-HIPE-2020-scorer">https://github.com/impresso/CLEF-HIPE-2020-scorer</a>.</p>
<p>Assuming the CLEF-HIPE scorer is stored in ../CLEF-HIPE-2020-scorer/,
run scorer as follows:
For NER:
&gt; python ../CLEF-HIPE-2020-scorer/clef_evaluation.py –ref outputs/results/lwm-true_bundle2_en_1.tsv –pred outputs/results/lwm-pred_bundle2_en_1.tsv –task nerc_coarse –outdir outputs/results/
For EL:
&gt; python ../CLEF-HIPE-2020-scorer/clef_evaluation.py –ref outputs/results/lwm-true_bundle2_en_1.tsv –pred outputs/results/lwm-pred_bundle2_en_1.tsv –task nel –outdir outputs/results/</p>
<dl>
<dt>Argument:</dt><dd><p>hipe_scorer_results_path (str): first part of the path of the output path.
scenario_name (str): second part of the path of the output file.
dresults (dict): dictionary with the results.
articles_test (list): list of sentences that are part of the</p>
<blockquote>
<div><p>split we’re using for evaluating the performance on this
particular experiment.</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A tsv with the results in the Conll format required by the scorer.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils.process_data.store_results">
<span class="sig-prename descclassname"><span class="pre">utils.process_data.</span></span><span class="sig-name descname"><span class="pre">store_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">task</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">how_split</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">which_split</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#utils.process_data.store_results" title="Permalink to this definition"></a></dt>
<dd><p>Function which stores the results of an experiment in the format
required by the HIPE 2020 evaluation scorer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment</strong> (<em>preparation.Experiment</em>) – the current experiment.</p></li>
<li><p><strong>task</strong> (<em>str</em>) – either “ner” or “linking”. Store the results for just
ner or with links as well.</p></li>
<li><p><strong>how_split</strong> (<em>str</em>) – which way of splitting the data are we using?
It could be the “originalsplit” or “Ashton1860”, for example,
which would mean that “Ashton1860” is left out for test only.</p></li>
<li><p><strong>which_split</strong> (<em>str</em>) – on which split are we testing our experiments?
It can be “dev” while we’re developing the code, or “test”
when we run it in the final experiments.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="preprocess_data.html" class="btn btn-neutral float-left" title="utils.preprocess_data module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="process_wikipedia.html" class="btn btn-neutral float-right" title="utils.process_wikipedia module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Federico Nanni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>